<!DOCTYPE html>
<html dir="ltr" lang="ja">
    <head>
        <title>プログラミング作法の世界観３A（制御フロー） - from Assy</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="keywords" content="Assy,アッシー,詩,小説,物語,歴史,政治,経済,コンピュータ,パソコン,Linux,エッセイ,散文,哲学">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="../../css/style.css">
        <link rel="stylesheet" href="../../css/prettify.css" type="text/css">


<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">

    </head>
    <body>
<div class="page">
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/script_smartmenus.js"></script>
<script type="text/javascript" src="../../js/links2.js"></script>

<p><a href="index.html">プログラミング言語の世界観に戻る</a></p>
<div class="sidebar">
<iframe src="../../menus/prog_lang_skill_menu.html" class="sideiframe"></iframe>
</div>
<h1>プログラミング作法の世界観３A（制御フロー）</h1>
<p>プログラミング作法に関する世界観３A（制御フロー）です。<a href="c_flow.html">Cの世界観２（制御フロー）</a>も参照のこと。</p>

<h2>関連ページ</h2>
<ul class="defaultlist list6 menu_list">
<li><a href="programming_intro.html">プログラミングをはじめよう</a></li>
<li><a href="programming_basic.html">プログラミング作法（１．基本）</a></li>
<ul>
<li><a href="programming_method.html">２．プログラミング入門</a></li>
<li><a href="programming_expert.html">３．エキスパート</a></li>
<ul>
<li><b>３A．制御フロー</b></li>
<li><a href="programming_data.html">３B．データ操作</a></li>
<li><a href="programming_pointer.html">３C．ポインタとメモリ管理</a></li>
</ul>
<li><a href="programming_tech.html">４．テクニック</a></li>
</ul>
</ul>

<div id="toc"></div>
<div class="page_links">


<h1>制御フロー</h1>
<h2>制御構造とフローチャート</h2>
<p>ifやforなどの「条件分岐」と「繰り返し」は、その時その時の場合によってプログラムが何を実行し、何を実行しないか、どれだけ実行し続けるか、を条件的に記述します。</p>
<p>変数が何を持っているか、条件式が何を判断しているか、実行するか実行しないかの範囲と内容は何か、いつどのように実行されるか、いつどのように実行されないか、などを考えると良い。</p>
<p>紙にフローチャートを書いて練習すると良いでしょう。</p>
<p><a href="algorithm.html">アルゴリズム</a>も参照のこと。</p>

<h2>条件式に応じたプログラミング</h2>
<p>ここで重要なのは、「条件式」です。条件式に応じて、条件が満たされる間繰り返し処理を実行したり、分岐して別々のコードブロックを実行したり、変数に別の値を代入したりします。</p>
<p>当然のことながら、条件式が間違っていた場合は、プログラムは正しく動きません。</p>
<p>条件によって別の関数を実行する関数のように、「ラッパー的な関数」を作ることもあります。</p>
<p>また、ゲームであれば、ランダムな数値を変数に代入したり、敵が出現するかどうかの判定や、キャラクターの攻撃が当たるかどうかの判定、敵の生死の判定、ターンごとに攻撃に参加できるかどうかの判定などにも、条件式と変数の代入を使います。</p>
<p>データベースやファイルシステムであれば、データの一意の識別のためにキーとなるIDナンバーやiノードなどを代入して、条件ごとにコードブロックや関数を実行します。</p>
<p>また、代入されている変数の値に応じて、別々の処理や制御を行うこともあります。</p>
<p>先のゲームの判定で言えば、代入されている値に生存が代入されていればゲームを続け、死が代入されていればゲームを終了する、といった具合です。</p>
<p>条件式に応じたプログラミングは、C言語のコマンドラインプログラムなどに多くみられます。</p>
<p><a href="structured_programming.html">構造化プログラミング</a>も参照のこと。</p>

<h2>イベント駆動によるプログラミング</h2>
<p>条件式以外の制御フローとしては、イベント駆動などが考えられます。</p>
<p>たとえばゲームであれば、キャラクターがジャンプした時、どれくらいキャラクターが上に飛び上がるかとか、キャラクターが前方方向に進んだ場合に敵に当たらないか、ステージから落ちないか、画面をスクロールするかどうか、のようなことをイベント駆動で行います。</p>
<p>これはイベントループによって、何らかのイベントが生まれるまで待機し、何らかのプレイヤーの操作が行われたらそれに応じた処理や判定をして画面を再描画する、といった具合で実現できます。</p>
<p>イベント駆動によるプログラミングは、UNIXのカーネルや、GUIのプログラム、ネットワークサーバーなどに多くみられます。特にGUIではメッセージループとイベント駆動により、ツールキットフレームワークを使ったプログラム開発を行うため、CUIのプログラムよりも冗長で複雑かつ、プラットフォーム依存のプログラムになります。</p>
<p><a href="event.html">イベント駆動</a>も参照のこと。</p>

<h2>抽象的な基盤システムの構築</h2>
<p>また、プログラムを作る上で重要な考え方が、「抽象的な基盤システムの構築」です。</p>
<p>たとえば、ゲームを作るのであれば、ひとつひとつの対戦画面を作るのではなく、ひとつの「共通の対戦を行うための画面」を作って、そこに具体的なデータを流し込んで、戦闘画面を作ります。</p>
<p>そのため、ピカチュウとカイリューが戦うのであっても、ニドキングが戦うのであっても、作るべきなのは、ひとつの「対戦画面」です。</p>
<p>マップ画面やダンジョン画面も同じです。ひとつひとつのダンジョンを一から作るのではなく、「共通のマップ画面」を作り、そこにキャラクターの「ドットイメージ」をマスの中に表示していきます。</p>
<p>どんなゲームであっても、これは変わりません。カードゲームなら、盤面の画面をひとつ作ります。3D対戦ゲームなら、3D画面を作ります。また、シミレーションRPGであっても、マップを移動するそれぞれの「駒」を適切に表示するような画面を作ります。</p>
<p><a href="../videogame/games_devel.html">ゲーム開発</a>も参照のこと。</p>

<h2>繰り返しを使ったプログラム</h2>
<p>プログラム初心者が忘れがちなこととして、「繰り返しの回数も数である」というのがある。</p>
<p>たとえば、10という数字が与えられて、10回繰り返しの中の文を繰り返すプログラムというのがこれである。</p>
<p>プログラミングとは、「その数から何をするか」という「文の実行順序・実行回数」を書く作業である。このため、回数も数である、ということは大切である。</p>
<p>また、繰り返しには条件式を使ったり、あるいはbreak文が実行されるまで永遠に繰り返したりなど、「繰り返しを終える条件」というのも必要である。</p>
<p>たとえば、味方の全キャラクターが死ぬか、敵の全キャラクターが死ぬまで、互いにキャラクター一人ずつが互いに攻撃する、といったゲームがこうしたプログラムである。</p>

<h2>正規表現を使ったプログラム</h2>
<p>また、繰り返しと良く似ているのが、正規表現を用いた文字列をパターンマッチングさせるプログラム。</p>
<p>たとえば、HTMLをTeX文書に変換するスクリプトなどがこれである。</p>
<p>HTMLをTeXにコンバートするためには、それぞれのタグをTeXのマクロに変換する必要がある。</p>
<p>たとえば、</p>
<p>１．コメント部分（&lt;!--～--&gt;）を削除する。（これだけでも、きちんと作るのは大変）</p>
<p>２．&lt;body&gt;から&lt;/body&gt;までを切り出す。</p>
<p>３．切り出した内容について、&lt;script&gt;～&lt;/script&gt;を削除する。</p>
<p>４．&lt;h1&gt;～&lt;/h1&gt;などをsectionやsubsectionなどに変換する。</p>
<p>５．それぞれのタグ（&lt;li&gt;など）を適切にTeXのマクロに変換する。</p>
<p>６．必要のないタグ（&lt;p&gt;など）を削除する。</p>
<p>７．最後に、TeXの適切な記述をヘッダ部分とフッタ部分に追記する。</p>
<p>このようになる。実用性を考えるならば既にあるコンバートツールを使うか、手動でテキストエディタで検索・置換を繰り返した方が良いだろうが、プログラミングの勉強としては最適である。</p>
<p><a href="../linux/regex.html">正規表現</a>も参照のこと。</p>

<h2>関数は自動の実行処理</h2>
<p>また、関数は自動の実行処理です。ある引数に基づいて、どのような処理を行うかが、汎用的に記述され、汎用的に実行されます。</p>
<p>引数とreturnを上手く使いましょう。また、再帰を使うことも良くあります。再帰とは「その関数の中でその関数を呼び出すこと」です。</p>
<p>後日注記：言ってしまえば、定型の処理をあらかじめ記述しておいて、そこにどんな引数が来ても良いようにプログラムを記述し、さまざまな引数によって呼び出して実行し、その結果となる返り値を返す、これが関数の基本です。そのため、自動の実行処理と言えます。</p>
<p><a href="function.html">関数</a>も参照のこと。</p>

<h2>サブルーチンはサブのルーチン</h2>
<p>また、サブルーチンはサブのルーチンだと思えば良く分かります。「メインのルーチン」があったとして、そこに「サブのルーチン」を作り、メインからサブを呼び出すのです。</p>
<p>ひとつの処理の流れがあったとして、関数やサブルーチンにはそのメイン処理とは別の処理の流れがあります。</p>
<p>メインルーチンからさまざまなサブルーチンに移動することでプログラムは動きます。つまり、「メインのプログラムとは別個にあるサブのプログラム」があり、「プログラムが別のプログラムを呼び出す」ような形で全体のプログラムを作ることで、構造化プログラミングは成り立ちます。</p>

<h2>小規模プロジェクトと大規模プロジェクト</h2>
<p>プログラムには、小規模プロジェクトと大規模プロジェクトがあります。</p>
<p>小規模プロジェクトは、たとえば簡単なUNIXコマンドや、掲示板スクリプトなどです。こうした小規模のプログラムは、ひとつのファイルで正しく制御フローを記述します。関数もいくらかしかありません。</p>
<p>これに比べて、大規模なプロジェクトは、LinuxカーネルやNetBSDカーネル、あるいはApache httpdサーバなどです。こうした大規模なプログラムは、ディレクトリを大きなサブディレクトリ階層構造に正しい規則で分類し、ソースファイルは関数だけではなくライブラリやコンポーネント機構を使ってモジュール化していきます。</p>
<p>また、小規模でも大規模でもない、普通ぐらいの規模のプログラムというものも存在します。これはIEコンポーネントを用いたタブブラウザや、テキストエディタなどです。</p>
<p>どんなプログラムを作るのであっても、まずは小さなプロトタイプの開発から始めます。データ型や汎用的な関数は開発の途中段階で開発します。また、リファクタリングとテストを行い、ひとつひとつソースファイルを整理していきます。同時に、保守がしづらくならないように、分類の方法、分化の方法を考えながら開発を行います。</p>
<p>もちろん、動くためのアルゴリズムやアーキテクチャも考えなければなりません。中心となるアルゴリズムを、どのような設計と実装で実行するように作るかが鍵となります。</p>

<h2>プログラミングとは手続きの記述</h2>
<p>また、プログラミングとは「手続き」の記述であると考えられます。</p>
<p>これは、ハードウェアに近い処理で言えます。特に顕著なのがネットワーク処理（ネットワーキング）です。ネットワークでは、ソケットインターフェースを使って、手続きそのもののプログラミングを行います。多くのコードが、形式的な手続きの記述になります。</p>

<h2>パソコンはテキストの動く機械</h2>
<p>また、現代的なコンピュータは、「テキストの動く機械」であると考えられます。</p>
<p>この「テキスト」とは、プログラムの書かれたソースコード、設定ファイルや設定データベース、そしてデータファイルやログファイルなどが言えます。</p>
<p>UNIXのプログラムは、プログラムのソースコードとバイナリファイル、設定ファイル、データファイルがセットになっています。プログラムが設定とデータを読み込んでプログラムの動作が決定されます。場合によっては、コマンドの実行オプションや引数、そしてプログラムをコンパイルする時のビルドオプションまでが、プログラムの動作を決定すると考えることができます。ほかにも、モジュールや拡張機能などで、プログラムをカスタマイズできます。ソースコードを直接編集しなくても、オブジェクト指向の機能やマクロ言語などの機能を用いて、プログラムをカスタマイズすることができることもあります。</p>
<p>この「テキストが動く機械」という発想は、Gentoo Linuxをやると良く分かります。Gentooでは、Portageと呼ばれるソースベースのパッケージ管理システムを使うことで、プログラムをコマンドに応じて自動でダウンロード・ビルド・インストールできます。まさに「Linuxがどのように形作られるのか」を、コンパイルやインストールなどの出力を「自分の目で見る」ことで知ることができます。また、Gentooでは設定を自分で設定ファイルに手動で書くことによって行いますが、これにより、「自分で設定した内容を自分で見て設定する」ことができます。インストーラもありませんが、ローリングリリースを採用しており、一度インストールしたら二度同じことをする必要はありません。</p>
<p><a href="code_file.html">コードとファイル</a>や<a href="../linux/gentoo.html">Gentoo</a>も参照のこと。</p>

<h2>エラー処理と例外</h2>
<p>C言語では、ファイルのオープンの際、ファイルがきちんと存在し、読み書き権限が得られ、オープンに成功した時と、そうでない時を区別し、エラーが発生した時のためにエラー処理をしなければなりません。</p>
<p>これに対して、C++やJavaなどのオブジェクト指向言語では、「例外」を用いてエラー処理を行うことができます。例外が吐かれると、その時点でコードの実行をやめ、「キャッチブロック」と呼ばれるブロックにキャッチされて、そのエラーを処理することができます。</p>
<p><a href="java_gc.html">Java（２C．ガーベッジコレクションと例外）</a>も参照のこと。</p>

<h2>関数は呼び出し方を想定しながら、共通の処理をひとつにまとめるように作る</h2>
<p>また、関数を作る時のコツとして、「呼び出し方」を考えながら、「共通の処理をひとつにまとめる」ように作ります。</p>
<p>関数の呼び出し方は、たとえば引数に2つのint型の数値を取って、int型の返り値を返す、といった具合です。</p>
<p>共通の処理をひとつにまとめるとは、たとえばお札の数を数える時に、ひとつひとつのお札の条件比較をする処理を、ひとつのルーチンにまとめる場合などが考えられます。</p>
<p>ここで、ポインタが活躍します。というのも、共通の処理をひとつにまとめる上で、どうしても引数を関数の中から参照だけではなく変更したい場合があるからです。</p>
<p>ポインタだけではなく、グローバル変数やオブジェクト指向のクラスとオブジェクトを使うことで、「たくさんの関数の中でどのようにデータを保持し、共有してアクセスするか」を考えなければいけないこともあります。関数の外側にある、関数を呼び出した元のローカル変数にアクセスしたい場合は、やはりポインタが活躍するでしょう。</p>

<h2>関数いろいろ</h2>
<p>関数について他には、Windows APIやVisual Basicのようなイベント駆動の考え方を用いて、「コールバック関数」のように使う方法があります。</p>
<p>これは、既にあるシステムから自分の作った関数を登録して「自動で適切に実行されるようにする」という考え方です。</p>
<p>JavaScriptでも、HTMLのタグの中でJavaScriptの関数を呼び出すことで、「クリックされたらこの関数を実行する」といった具合にすることができます。</p>
<p>また、Pythonなどでは、関数型プログラミングの考え方で、mapなどに関数を渡して、「関数そのものを関数の引数として渡す」といったことができます。C言語では、関数ポインタを使うことで同じことができます。</p>
<p>また、関数について他に言うと、オブジェクト指向ライクな考え方として、「特定のデータ構造を操作する一連の関数を用意して、その関数からデータ構造を操作する」という発想があります。オブジェクト指向では、こうした関数をメソッドと呼び、データ構造とメソッドが一体化したものをクラスと言い、オブジェクトを作成し特定のインターフェースから操作することをカプセル化と言います。</p>
<p>また、オブジェクト指向と似た考え方として、「関数のスコープと同じ場所にある変数に関数の内部からアクセスする」という方法があります。これを「クロージャ」と呼びます。クロージャにより、スクリプトライクに共通のデータをさまざまな関数から操作できます。</p>
<p><a href="oop.html">オブジェクト指向</a>や<a href="closure.html">クロージャ・無名関数・関数オブジェクト</a>も参照のこと。</p>

<h2>新しい分岐構文</h2>
<p>新しい分岐構文として、僕は以下のような構文があってもいいと思う。</p>
<pre class="prettyprint">
par (p = [1-100]) {
    print(p);
}
</pre>
<p>この時、pには1から100までの値が代入され、100個のスレッドができて、並列で実行される。</p>
<p>if文やfor文を使ったり、pをインクリメントするよりも高速で、効率的になるし、並列処理としても使いやすいと思う。</p>
<div class="edit_date">
<p>2025.09.23</p>
</div>


</div></div> <!--page-->










<script type="text/javascript" src="../../js/jquery.toc.js"></script>
<script type="text/javascript" src="../../js/script.js"></script>
<script type="text/javascript" src="../../js/scriptfortoc.js"></script>
<script type="text/javascript" src="../../js/prettify.js"></script>
<script>prettyPrint();</script>
</body>
</html>