<!DOCTYPE html>
<html dir="ltr" lang="ja">
    <head>
        <title>イベント駆動の世界観 - from Assy</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="keywords" content="Assy,アッシー,詩,小説,物語,歴史,政治,経済,コンピュータ,パソコン,Linux,エッセイ,散文,哲学">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="../../css/style.css">


<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">

    </head>
    <body>
<div class="page">
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/script_smartmenus.js"></script>
<script type="text/javascript" src="../../js/links2.js"></script>

<p><a href="index.html">プログラミング言語の世界観に戻る</a></p>
<div class="sidebar">
<iframe src="../../menus/prog_lang_skill_menu.html" class="sideiframe"></iframe>
</div>
<h1>イベント駆動の世界観</h1>
<p>イベント駆動の世界観です。<a href="parallel.html">並列処理</a>も参照のこと。</p>

<div id="toc"></div>
<div class="page_links">

<h1>イベント駆動</h1>
<h2>イベント駆動とは</h2>
<p>イベント駆動とは、「外部の環境から何らかのイベントが伝えられて、そのイベントに応答する形でプログラムを書く」こと。</p>
<p>Linuxカーネルのように、全てのプログラムのベースとなる環境的なプログラムや、Windows APIのように外部のメッセージの通信によって、ユーザーのハードウェア操作や中心となるウィンドウシステムの命令に応答するプログラムでは、形こそ違えど、このイベント駆動と呼ばれる制御モデルを設計の中心としている。</p>
<p>Linuxカーネルは、自分から何もしないプログラムで、ソフトウェアのシステムコール呼び出しやハードウェアの割り込みに対して、応答することでしか処理が行われない。これはNginxのようなサーバーデーモンや、コマンドラインシェルやインタープリタなどにも似ているスタイルである。</p>
<p>また、GUIのウィンドウアプリケーションでは、一言にイベント駆動といっても、何種類かのやり方の違いがある。ひとつは、XlibやWindows APIやSwingのリスナのように、イベントが常に送られてきて、次のイベントが送られてくる間隔をループし、メッセージループでそのイベントメッセージを処理するという方式。もうひとつは、そうしたメッセージループをフレームワークが行い、ユーザーはイベントハンドラやコールバック関数をウィジェットに登録し、自動的にメッセージがやり取りされるようにする方式（これを指してイベント駆動とかイベントドリブンと呼ぶこともある）。他にも、MFCのようにメッセージマップに対応するクラスライブラリのメソッドを継承・オーバーライドする方式などがある。</p>
<p>イベント駆動のプログラムは、えてして巨大化しやすい。巨大化すると小さな環境で動かないこともあり、開発の困難さも増え、軽量さやパフォーマンスも落ちる。特に、これがマイクロカーネルなどといったさらに高度なプログラムになると、開発が破綻してしまう。Linuxカーネルでは、モジュールを実行時に動的に追加・削除できるようなモジュラー化のスタイルを取りながら、不要な機能は必要に応じて削除できるようにし、マイクロカーネルではなくモノリシックカーネルの方式をとることで、開発を単純にし、パフォーマンスを向上させている。</p>

<h2>Windowsとイベント駆動</h2>
<p>こうした「イベント駆動」については、長い間コマンドラインインターフェースを取ってきたUNIXよりも、Windowsに軍配が上がる。</p>
<p>UNIXでは、X11を使う場合であってもコマンド操作が中心となるため、「万人が操作しやすいGUIインターフェースを作る」ということがおろそかになってきた。それはコマンドラインの優れた機能、grep/sed/awkやコマンドのオプションやシェルスクリプトなどを使いこなすことで、簡単に自動で処理を行うことができる、というメリットが、逆に初心者や一般ユーザー向けのことを考えてこなかったということの結果である。</p>
<p>アラン・ケイのダイナブック構想からMacintoshやWindowsに繋がる、「GUIによる仕事用のインターフェース」というモデルは、そもそもUNIXは取ってこなかった。逆に、Windowsにおいては、多くのプログラムが単純な「マウスやキーボードへの応答」となってしまい、グラフィックスやインタラクティブな操作による直感性と使いやすさはあるものの、バッチ処理による自動化やスクリプティングのことは考えられていない。多くの場合スクリプトは記述できず、手作業で操作を行わなければファイルやテキストの編集はできない。アプリケーションの機能や重さも大きく肥大化する傾向にあり、不正終了やフリーズも多い。また、ひとつのアプリケーションがシンプルなスタイルをとっておらず、複雑怪奇であるため、バグも多く、開発も困難を極める。（だが、Windowsについて言えばインターネット上のフリーソフトは豊富に存在し、テキスト処理を行うのであれば、サクラエディタなどのサードパーティのフリーソフトを使うことで何とかできる場合もある。）</p>
<p>UNIXのコマンドラインプログラムであれば、単純なプログラムとなり、枯れた技術でもあるためバグの入り込む余地が少なく、ひとつの「カーネル」の上で小さなプログラムが動くというシンプルなスタイルから安定しており、信頼性が高い。そのため、データベースやネットワークサーバーなどの高信頼性や高いスループレットが必要な処理では、UNIXのようなコマンドラインのOSが今でも使われるのである。</p>
<p>ある意味、Windowsは「仕事用で使う真面目な目的のためのゲーム」のようなものであると考えられる。ディスプレイに表示されるウィンドウと、マウスやキーボードによるイベント駆動が、ゲームのコントローラと似ているからである。逆に、UNIXは計算処理をたくさんさせるための「昔ながらのバッチ処理インターフェース」であると考えられる。Windowsは使っていて面白いが、UNIXは目的がなければ何の面白さもないだろう。</p>
<p>また、最近はLinuxにおいても、Windowsと同様のGNOMEやKDEのようなGUI環境が増えてきた。確かにWindows並みに使えるものにはなっているが、僕はこれらについてはまだまだであると思う。Windowsと似通った独自性のないインターフェースになっているし、Windowsと同程度にバグが多く、また解決が難しい不具合が多くみられ（特に日本語環境）、情報にありつける頻度は極端に少ない。こうした分野でWindowsと同じものを目指してはいるものの、まだまだ未完成品であると評価せざるを得ない。だが、一部のマニアックなオタクにおいては、Windowsとは違う「オープンソースなLinuxデスクトップ」として崇拝されており、それが悪いことであるとは思わない。逆に、GNOMEやKDEでも、ターミナルエミュレータを使うことはほぼ必須であり、またWindowsとは違って多くのオープンソースソフトウェアが無料でついてくるため、優れた素敵な環境にはなっている。カスタマイズ性も高い。開発環境やUNIXの練習環境、あるいはただの遊び用途であれば、お金を一銭も払わずに導入でき、「みんなでインターネット上で開発していて、自分も参加したい」という、研究・教育用途にはうってつけである。逆に言えば、研究・教育用途以外に、使い道はないだろう。</p>

<h1>状態遷移・オートマトン</h1>
<h2>状態遷移</h2>
<p>状態遷移とは制御モデルのひとつで、システムの状態を表すデータを保持しておいて、その状態データがどのように変わるかによって、実行の制御が変わってくるというモデル。</p>
<p>僕の作った<a href="../programs/robot.html">ロボット</a>なんかがいい例かもしれない。</p>
<p>状態遷移によるシステムは、「状態マシン」（オートマトン）としてモデル化が行われる。</p>
<p><a href="state.html">状態</a>も参照のこと。</p>
<p>（<a href="https://www.amazon.co.jp/Reading-%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E3%82%BD%E3%83%BC%E3%82%B9%E3%81%8B%E3%82%89%E5%AD%A6%E3%81%B6%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A7%E3%82%A2%E9%96%8B%E7%99%BA%E6%8A%80%E6%B3%95-%E3%83%97%E3%83%AC%E3%83%9F%E3%82%A2%E3%83%A0%E3%83%96%E3%83%83%E3%82%AF%E3%82%B9%E7%89%88-Diomidis-Spinellis/dp/4839956693">Code Reading ~オープンソースから学ぶソフトウェア開発技法~ (プレミアムブックス版)</a>を参考にして執筆しました。）</p>

<h2>セルオートマトン</h2>
<p>セルオートマトンとは、要素の状態が隣り合う別の要素へと影響するようなシミュレーションモデルのこと。</p>
<p>もともとは生物の細胞分裂をシミュレーションするために用いられた。</p>
<p>（放送大学「コンピュータとソフトウェア ('18)」を参考に執筆しました。）</p>
<div class="edit_date">
<p>2023.04.14</p>
</div>

<h1>各言語の実装</h1>
<h2>GUI開発</h2>
<p><a href="gui_develop.html">GUI開発</a>を参照のこと。</p>

<h2>Windows API</h2>
<p><a href="windows_programming.html">Windows API</a>を参照のこと。</p>

<h2>Java Swing</h2>
<p><a href="java_gui_swing.html">Swing</a>を参照のこと。</p>

<h2>C#/VB</h2>
<p><a href="csharp.html">C#</a>や<a href="vb.html">Visual Basic</a>や<a href="vb_form.html">Visual Basic（フォームデザイナー）</a>を参照のこと。</p>

<h2>X11</h2>
<p><a href="../linux/linux_x11_admin.html">X11設定とプログラミング</a>や<a href="../linux/gtk.html">GTK</a>を参照のこと。</p>

<h1>関連ページ</h1>
<h2>状態</h2>
<p><a href="state.html">状態</a>も参照のこと。</p>

<h1>余談</h1>
<h2>機能を有効化・無効化し、ループするプログラム</h2>
<p>僕は、単純にprint()やinput()で入出力を行うプログラムは、プログラムのモデルとして単純すぎるのではないかと思う。</p>
<p>たとえば、機能を有効化・無効化し、ループするプログラムは考えられないだろうか。</p>
<p>このプログラムは、たとえばリンゴを木から落とし続ける猿のように、何も設定しなければ同じことを永遠に繰り返すが、さまざまなタイミングで機能を有効化・無効化することで、その動きを変えることができる。</p>
<p>なので、猿に対して「リンゴを落とせ」という命令を有効化するとリンゴを落とし続けるが、この命令を無効化し、「ブドウを落とせ」という命令を有効化すると、今度はブドウを落とし続ける。</p>
<p>これは、ある意味、AI的なところがあると思う。AIのようなプログラムを書く上で、このようなプログラムは単にprint()やinput()を命令通りに行うよりも、高度であるように思う。</p>

<h2>イベントループか、マルチスレッドか</h2>
<p>実際のところ、並列処理を実現する上で、イベントループの方法を取るか、それともマルチスレッドの方法を取るかは重要な問題です。</p>
<p>たとえば、<a href="../network/apache.html">Apache</a>のようなWebサーバーは、マルチスレッドやプロセスを使った並列処理を行いますが、プロセスが一万を超えたぐらいから不安定になることが知られています。</p>
<p>これに対して、<a href="../network/nginx.html">Nginx</a>や<a href="../prog_lang/node_js.html">Node.js</a>では、プロセスやスレッドはひとつのまま、接続ごとにイベントループを行うことで、この問題を解決し、軽量かつ少ないメモリで動くサーバーを実現しています。</p>
<p>つまり、Webサーバーにおいては、マルチスレッドを用いた並列処理よりも、イベントループのほうが優れているということを意味しています。</p>
<p>ほかの分野についてはどうでしょうか。Linuxカーネルは、マルチプロセスと仮想アドレス空間によるマルチタスクを行いますが、同時にシステムコールによるイベント駆動を行います。また、Windows APIでは、コールバック関数の呼び出しと同時にメッセージループを行います。</p>
<p>つまり、イベントループと並列処理は、「どちらも一緒に現れる」ようなモデルです。多くが、「イベント駆動をしながら並列処理をしている」と言えます。なので、どちらがどちらに対して優越しているものではないのかもしれません。</p>

</div></div> <!--page-->










<script type="text/javascript" src="../../js/jquery.toc.js"></script>
<script type="text/javascript" src="../../js/script.js"></script>
<script type="text/javascript" src="../../js/scriptfortoc.js"></script>
</body>
</html>