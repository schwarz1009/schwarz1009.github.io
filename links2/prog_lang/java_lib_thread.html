<!DOCTYPE html>
<html dir="ltr" lang="ja">
    <head>
        <title>Java関連の世界観３D（マルチスレッド） - from Assy</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="keywords" content="Assy,アッシー,詩,小説,物語,歴史,政治,経済,コンピュータ,パソコン,Linux,エッセイ,散文,哲学">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="../../css/style.css">
        <link rel="stylesheet" href="../../css/prettify.css" type="text/css">


<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/manifest.json">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">

    </head>
    <body>
<div class="page">
<script type="text/javascript" src="../../js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/script_smartmenus.js"></script>
<script type="text/javascript" src="../../js/links2.js"></script>

<p><a href="index.html">プログラミング言語の世界観に戻る</a></p>
<div class="sidebar">
<iframe src="../../menus/prog_lang_java_menu.html" class="sideiframe"></iframe>
</div>
<h1>Javaの世界観３D（マルチスレッド）</h1>
<p>Javaによるプログラミングに関する世界観３D（マルチスレッド）です。</p>
<h2>関連ページ</h2>
<ul class="defaultlist list6 menu_list">
<li><a href="java.html">Java（１．文法）</a></li>
<li><a href="java_oop.html">２．オブジェクト指向</a></li>
<ul>
<li><a href="java_oop_extends.html">２A．継承</a></li>
<li><a href="java_oop_interface.html">２B．インターフェース</a></li>
<li><a href="java_gc.html">２C．ガーベッジコレクションと例外</a></li>
</ul>
<li><a href="java_lib.html">３．クラスライブラリ</a></li>
<ul>
<li><a href="java_lib_io.html">３A．入出力</a></li>
<li><a href="java_lib_list.html">３B．コレクションと配列</a></li>
<li><a href="java_lib_string.html">３C．文字列</a></li>
<li><b>３D．マルチスレッド</b></li>
<li><a href="java_lib_xml.html">３E．XML</a></li>
<li><a href="java_lib_image.html">３F．画像処理</a></li>
<li><a href="java_lib_net.html">３G．ネットワーク・データベース</a></li>
</ul>
</ul>

<div id="toc"></div>
<div class="page_links">


<h1>マルチスレッド</h1>
<h2>C++とJavaのマルチスレッド</h2>
<p>C++では、C++11においてstd::threadが提供されるまで、標準のC++ではスレッドの概念がありませんでした。</p>
<p>このため、C++でマルチスレッドプログラミングを行うには、UNIX系のpthreadなど、プラットフォーム依存のコードを書かなければいけませんでした。</p>
<p>Javaでは、早くからスレッドの概念を導入し、標準のAPIとしてマルチスレッドアプリケーションを書くことができます。</p>
<p>詳しくは以下の書籍が参考になります。</p>
<ul>
<li><a href="https://www.amazon.co.jp/Java%E8%A8%80%E8%AA%9E%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3-%E7%AC%AC3%E7%89%88-%E4%B8%8B-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%8C%87%E5%90%91%E3%82%92%E5%A7%8B%E3%82%81%E3%82%88%E3%81%86-%E7%B5%90%E5%9F%8E/dp/4797371269">Java言語プログラミングレッスン 第3版(下) オブジェクト指向を始めよう</a></li>
<li>やねうらお氏の「<a href="https://www.amazon.co.jp/Windows%E3%83%97%E3%83%AD%E3%83%95%E3%82%A7%E3%83%83%E3%82%B7%E3%83%A7%E3%83%8A%E3%83%AB%E3%82%B2%E3%83%BC%E3%83%A0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0-%E3%82%84%E3%81%AD-%E3%81%86%E3%82%89%E3%81%8A/dp/479800314X">Windowsプロフェッショナルゲームプログラミング</a>」「<a href="https://www.amazon.co.jp/Windows%E3%83%97%E3%83%AD%E3%83%95%E3%82%A7%E3%83%83%E3%82%B7%E3%83%A7%E3%83%8A%E3%83%AB%E3%82%B2%E3%83%BC%E3%83%A0%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B02%E3%80%90CD-ROM%E4%BB%98%E3%80%91-Game-developer-books-%E3%81%86%E3%82%89%E3%81%8A/dp/4798006033">Windowsプロフェッショナルゲームプログラミング2</a>」</li>
<li><a href="https://www.amazon.co.jp/Effective-%E7%AC%AC3%E7%89%88-ADDISON-WESLEY-PROFESSIONAL-COMPUTI/dp/4621066099">Effective C++ 第3版</a></li>
</ul>
<p><a href="cpp_stl_libs.html">C++（STL・ライブラリ）</a>や<a href="../linux/linux_api2.html">Linux API（プロセス・メモリ）</a>も参照のこと。</p>

<h2>並列処理（マルチスレッド）の実現</h2>
<p>Javaのスレッドには、二通りのやり方がある。一つは、Threadクラスを継承する方法。もう一つは、Runnableインターフェースを実装する方法である。</p>
<p>Threadクラスの継承は単純なプログラム向けだが、複雑なプログラムになってくるとRunnableインターフェースを実装する方法を使うこともある。</p>
<p>後日注記：Runnableインターフェースを使う主な理由は、Javaでは多重継承ができないため。Javaでは単一のクラスしか継承することができないので、Threadクラスを継承すると別のクラスが継承できなくなる。このため、別のクラスを継承した上でマルチスレッドを行うためにRunnableインターフェースを実装する。どちらの場合でもrun()メソッドをオーバーライドして、newでインスタンスを生成してstart()メソッドをmain()などから実行すればよい。</p>
<p>以下はThreadクラスを継承する方法。</p>
<pre class="prettyprint">
public class CountByThread extends Thread {
    public static void main(String[] args) {
        CountByThread ct = new CountByThread();
        ct.start();
        // main()で行う処理をここに書く
    }
  
    @Override
    public void run() {
        // run()で行う処理をここに書く
    }
}
</pre>
<p>以下はRunnableインターフェースを実装する方法。</p>
<pre class="prettyprint">
public class CountByRunnable implements Runnable {
    public static void main(String[] args) {
        CountByRunnable cr = new CountByRunnable();
        Thread th = new Thread(cr);
        th.start();
        // main()で行う処理をここに書く
    }
  
    @Override
    public void run() {
        // run()で行う処理をここに書く
    }
}
</pre>
<p>run()メソッドで行う処理は、main()スレッドで行う処理とは並行して実行される。</p>
<p>ほかのクラスでもThreadクラスを継承あるいはRunnableインターフェースを実装してrun()メソッドを書けば、main()メソッドなどからさらに多くのスレッドを実行できる。</p>
<p>（以上は<a href="https://www.amazon.co.jp/Java%E8%A8%80%E8%AA%9E%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3-%E7%AC%AC3%E7%89%88-%E4%B8%8B-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%8C%87%E5%90%91%E3%82%92%E5%A7%8B%E3%82%81%E3%82%88%E3%81%86-%E7%B5%90%E5%9F%8E/dp/4797371269">Java言語プログラミングレッスン 第3版(下) オブジェクト指向を始めよう</a>を参考に執筆しました。）</p>
<ul>
<li><a href="http://tech-blog.tsukaby.com/archives/192">Java初級者のための必須Java標準APIまとめと簡易解説 | つかびーの技術日記</a></li>
<li><a href="http://java-code.jp/297">Threadクラス／Runnableインターフェイス | Javaコード入門</a></li>
<li><a href="https://www.javadrive.jp/applet/thread/index3.html">Runnableインターフェース - スレッドの利用 - Javaアプレット入門</a></li>
</ul>

<h2>マルチスレッドの基本</h2>
<p>インスタンスのメソッドを実行する場合、メンバ変数（フィールド）の値を変更するようなメソッドを書くことがある。</p>
<p>これは単一スレッドで実行する場合は問題がないが、同一インスタンスのメンバ変数を編集する場合、そのメソッドをマルチスレッドで並列して複数実行させると、データの変更中に別のスレッドからデータを変更してしまい、データの矛盾が起きてしまうことがある。</p>
<p>このような時には、そのメソッドにsynchronizedというキーワードをつける。synchronizedメソッドは、シングルスレッドでしか実行されないように、実行中にインスタンスがロックされる。このため、このような場合にはデータを変更するメソッドをsynchronizedメソッドにすればいい。ブロックに対して同じことをしたい場合はsynchronizedブロックを使うことができる。</p>
<p>スレッドの一時停止は、Thread.sleep()で行える。</p>
<p>もし、別のスレッドの処理が終わるまで待機し、別のスレッドの処理が終わった段階で実行を再開したいなら、join()メソッドを使うことができる。</p>
<p>また、スレッド同士の間で待ち合わせを行う場合、wait()メソッドを実行すれば、通知が行われるまでそのスレッドは待機する。notify()メソッドやnotifyAll()メソッドを実行すると、待機していたwait()に対して通知を行い、ロックが解除された時点でwait()が再開する。</p>
<p>このように、マルチスレッドにしても問題がないようなプログラムのことをスレッドセーフと呼ぶ。</p>
<p>（以上は<a href="https://www.amazon.co.jp/Java%E8%A8%80%E8%AA%9E%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3-%E7%AC%AC3%E7%89%88-%E4%B8%8B-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%8C%87%E5%90%91%E3%82%92%E5%A7%8B%E3%82%81%E3%82%88%E3%81%86-%E7%B5%90%E5%9F%8E/dp/4797371269">Java言語プログラミングレッスン 第3版(下) オブジェクト指向を始めよう</a>を参考に執筆しました。）</p>

<h2>スレッドセーフ</h2>
<p>スレッドセーフとは、マルチスレッドの処理にしても問題が無い並列処理のプログラムのこと。</p>
<table class="some_tables">
<tr><th class="min60">原則</th><th>説明</th></tr>
<tr><td>ローカル変数を使う</td><td>複数のスレッドから変更されるかもしれないような、<br>クラス変数やインスタンス変数を使わず、<br>できるだけローカル変数を使う。<br>ローカル変数は複数のスレッドから共有されないため。</td></tr>
<tr><td>アトミック（単一不可分）</td><td>メソッドにsynchronizedを付加してロックを行う。<br>競り合い状態を発生させない。</td></tr>
</table>
<p>synchronizedメソッドやsynchronizedブロックの中の処理は、単一のスレッドでしか実行できない。</p>
<p>詳しくは以下のページを参考のこと（上の文章は以下のサイトを参考にしました）。</p>
<ul>
<li><a href="https://qiita.com/ika_katsuo/items/95a61293abff3235c0be">スレッドセーフってなに（with Java） - Qiita</a></li>
<li><a href="https://blog.j5ik2o.me/entry/20110130/1296367299">スレッドセーフにするために考えること 〜基礎編〜 - かとじゅんの技術日誌</a> - 詳しい。</li>
<li><a href="https://teratail.com/questions/100167">Java - マルチスレッド、スレッドセーフがいまいちわからない｜teratail</a> - 分かりやすい。</li>
<li><a href="https://qiita.com/subaru44k/items/13c52151b8d08fbc0380">Javaのsynchronizedの解説と典型的誤り集(記事の誤りや意見等あれば是非教えてください) - Qiita</a></li>
</ul>

<h2>スレッド関係のAPI</h2>
<p>スレッド関係のAPIとしては、以下のようなものがある。</p>
<table class="some_tables">
<tr><th class="min60">API</th><th>説明</th></tr>
<tr><td>Thread.sleep()</td><td>一定時間、スレッドを停止状態にする</td></tr>
<tr><td>Thread.join()</td><td>指定したスレッドの処理が終わるまで待ち、<br>そのスレッドの処理が終わってから処理を継続する</td></tr>
<tr><td>Thread.interrupt()</td><td>なんらかの処理をしているスレッドを中断させる<br>（割り込みを行う）</td></tr>
</table>
<p>ポーリング（定期的な問い合わせ）、コールバック（終わった時に呼び出す）、データ共有用オブジェクト（オブジェクトを共有）を使うことで、処理結果を受け取ることができる。</p>
<p>詳しくは以下のページを参考のこと（上の文章は以下のサイトを参考にしました）。</p>
<ul>
<li><a href="https://java2005.cis.k.hosei.ac.jp/materials/lecture26/multithreaded.html">マルチスレッドプログラミング - プログラミング演習 I, II (Java) - Hosei University</a></li>
<li><a href="https://engineer-club.jp/java-thread">Javaのスレッド(Thread)を使いこなすコツを、基礎からしっかり伝授 - ENGINEER.CLUB（エンジニアクラブ）</a></li>
</ul>

<h2>マルチスレッドのデザインパターン</h2>
<p>Javaのマルチスレッドについて、以下の書籍がマルチスレッドのデザインパターンを説明されています。Javaでマルチスレッドのプログラムの設計と実装をする皆さんにおすすめします。</p>
<ul>
<li><a href="https://www.amazon.co.jp/Java%E8%A8%80%E8%AA%9E%E3%81%A7%E5%AD%A6%E3%81%B6%E3%83%87%E3%82%B6%E3%82%A4%E3%83%B3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E5%85%A5%E9%96%80-%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E7%B7%A8-%E7%B5%90%E5%9F%8E-%E6%B5%A9/dp/4797319127">Java言語で学ぶデザインパターン入門 マルチスレッド編</a></li>
</ul>

<h2>書籍</h2>
<p>以下の書籍が参考になります。</p>
<ul>
<li><a href="https://www.amazon.co.jp/Java%E8%A8%80%E8%AA%9E%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E3%83%AC%E3%83%83%E3%82%B9%E3%83%B3-%E7%AC%AC3%E7%89%88-%E4%B8%8B-%E3%82%AA%E3%83%96%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%8C%87%E5%90%91%E3%82%92%E5%A7%8B%E3%82%81%E3%82%88%E3%81%86-%E7%B5%90%E5%9F%8E/dp/4797371269">Java言語プログラミングレッスン 第3版(下) オブジェクト指向を始めよう</a></li>
<li><a href="https://www.amazon.co.jp/%E6%94%B9%E8%A8%82-%E6%96%B0Java%E8%A8%80%E8%AA%9E%E5%85%A5%E9%96%80-%E3%83%93%E3%82%AE%E3%83%8A%E3%83%BC%E7%B7%A8-Java%E8%A8%80%E8%AA%9E%E5%AE%9F%E7%94%A8%E3%83%9E%E3%82%B9%E3%82%BF%E3%83%BC%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA-%E6%99%B4%E6%AF%94%E5%8F%A4/dp/479733021X">改訂 新Java言語入門 ビギナー編 (Java言語実用マスターシリーズ)</a></li>
</ul>

<h2>関連ページ</h2>
<p><a href="parallel.html">並列処理</a>も参照のこと。</p>


</div></div> <!--page-->










<script type="text/javascript" src="../../js/jquery.toc.js"></script>
<script type="text/javascript" src="../../js/script.js"></script>
<script type="text/javascript" src="../../js/scriptfortoc.js"></script>
<script type="text/javascript" src="../../js/prettify.js"></script>
<script>prettyPrint();</script>
</body>
</html>